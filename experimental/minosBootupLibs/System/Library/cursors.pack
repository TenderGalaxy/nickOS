require("display.pack")
require("utils.pack")
globalThis.decreaseClick = function(){
	userCursorPos = getPlayerLook()
	if(registerClick){
		api.log(userCursorPos)
		let m = ''
		while(clickFunctions.length > 0){
			m = clickFunctions.shift()
			m(userCursorPos)
		}
	}
	registerClick = false
	requestExecFunction(decreaseClick, '')
}
globalThis.getPlayerLook = function(){
	let z = api.getPlayerFacingInfo(user)
	let look = z.camPos
	z = z.dir
	z[0] *= (50-look[2])/z[2]
	z[1] *= (50-look[2])/z[2]
	z[0] += look[0]
	z[1] += look[1]
	z[0] = Math.round(z[0] + config.displayx/2)
	z[1] = Math.round(config.displayy - z[1])
	if(inBounds(z, 0, config.displayx - 3) && inBounds(z[1], 0, config.displayy - 3)){
		return z
	}
	return [0,0]
}
globalThis.onPlayerClick = function(id){
  api.log(user, id)
  if(id == user){
    registerClick = true
  }
}
clickFunctions = []
decreaseClick()
