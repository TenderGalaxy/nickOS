function onPlayerClick(e){let t=api.getHeldItem(e);if(null!=t&&"Spawn Block (Gray)"==t.name&&"NickOS Remote"==t.attributes.customDescription){osOn?(palette[0]=palette[1],task=["clearScreen",["shut"],0]):(OSboot(),user=e);return}osOn&&(s[4]=1)}function onPlayerAttemptAltAction(e){user==e&&osOn&&s[5]}function ctrack(){let e=api.getPlayerFacingInfo(user),t=e.camPos;return((e=e.dir)[0]=e[0]*((50-t[2])/e[2])+t[0],e[1]=e[1]*((50-t[2])/e[2])+t[1],e[0]=Math.round(e[0]+64),e[1]=Math.round(64-e[1]),inBounds(e[0],0,125)&&inBounds(e[1],0,61))?e:[0,0,0]}function jp(){let e=ctrack();s[2]=e[0],s[3]=e[1],e=api.getPosition(user),s[0]=e[0],s[1]=e[2],s[4]=Math.abs(s[4]-.25)-.25,s[5]=Math.abs(s[4]-.25)-.25}function drawCursor(){let e="100011010";for(let t=0;t<3;t++)for(let a=0;a<3;a++){let r=[s[7]-64+t,64-s[8]-a,50],$=display[s[7]+t][s[8]+a][1];api.setBlock(r,api.blockIdToBlockName($)),r=[s[2]+t-64,64-s[3]-a,50],api.setBlock(r,api.blockIdToBlockName(palette[e[3*t+a]]))}s[7]=s[2],s[8]=s[3]}function OSboot(){active=[],ram=[],s=[0,0,0,0,0,0,0,0,0],palette=[144,86],display=[],task=["clearScreen",["initmenu"],0],isFile=!1,loadFont(),curr_page=0,parentFolder=[0],directory=["~"],itemSlotPath=[],colors=[144,1724,8,47,483,32,97,59,6,31,28,29,136,85,946,947,948,84,949,950,951,147,66,86].reverse(),charset="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789|[]{}/-_>=+`~?.,;:",cColors=[2,1694,5,650,6,8,139,28,29,31,474,40,41,42,45,465,652,959,958,976,1630,1621,1629,946,947,948,949,950,951,482,484,486,471,140,961,962,147,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,97,93,92,90,99,91,94,84,85,89,95,87,88,98,96,86,1722,1271,212,1510,1576,1607,1608,1609],api.log("osSuccesfullyBooted"),osOn=!0}function loadFont(){font={A:"#### ##### ## #",B:"## # ### # ### ",C:"####  #  #  ###",D:"## # ## ## ### ",E:"####  ####  ###",F:"####  ####  #  ",G:"####  # ## ####",H:"# ## ##### ## #",I:"### #  #  # ###",J:"  #  #  ## ####",K:"# ## ### # ## #",L:"#  #  #  #  ###",M:"########## ## #",N:"#### ## ## ## #",O:"#### ## ## ####",P:"#### #####  #  ",Q:"#### ## ## ### ",R:"#### ## ### # #",S:"####   #   ####",T:"### #  #  #  # ",U:"# ## ## ## ####",V:"# ## ## ### #  ",W:"# ## ## #######",X:"# ## # # # ## #",Y:"# ## ## # #  # ",Z:"###  # # #  ###",a:"______ ### # ##",b:"#  #  #### ####",c:"______####  ###",d:"  #  ##### ####",e:"_______#_#_###_",f:"  # # ### #  # ",g:"____#_#_#_####_",h:"#  #  #### ## #",i:"___ # ___ #  # ",j:"  #___  #  ####",k:"#  #  # ### # #",l:"  #  #  #  # # ",m:"______####### #",n:"______#### ## #",o:"______#### ####",p:"___#### #####  ",q:"___#### ####  #",r:"______####  #  ",s:"______ ## # ## ",t:"___ # ### #  # ",u:"______# ## ####",v:"______# ## # # ",w:"______# #######",x:"______# # # # #",y:"______#_#_#_#__",z:"______##  #  ##",0:"#### ## ## ####",1:"##  #  #  # ###",2:"###  #####  ###",3:"###  ####  ####",4:"# ## ####  #  #",5:"####  ###  ####",6:"####  #### ####",7:"###  #  #  #  #",8:"#### ##### ####",9:"#### ####  #  #","-":"______###______","=":"___###___###___",_:"____________###","+":"___ # ### # ___","/":"__#_##_#_##_#__"," ":"               ",".":"_____________#_","!":"_#__#__#_____#_","?":"##___#_#_____#_",">":"______##___###_","<":"_______###___##",":":"____#_____#____",'"':"#_##_#_________","'":"_#__#_#________","&":"_#_#___#_#_###_",",":"__________#_#__","^":"_#_#_##_#______","|":"_#__#__#__#__#_","(":"_#_#__#__#___#_",";":"____#_____#_#__",")":"_#___#__#__#_#_","[":"##_#__#__#__##_","]":"_##__#__#__#_##","%":"#____#_#_#____#","*":"#_#_#_#_#______","{":"_##_#_##__#__##","}":"##__#__##_#_##_","~":"______#_#_#____"}}function dtxt(e,t,a){let r=0;for(let $=0;$<a.length;$++){for(let c=0;c<5;c++)for(let l=0;l<3;l++)"#"==(r=font[a[$]][3*c+l])?display[e+l][t+c][1]=palette[1]:display[e+l][t+c][1]=palette[0];(e+=4)>124&&(e=0,t+=6)}}function displayFolderSons(e){if(e[1]<7&&e[1]+e[2]<36){let t=api.getStandardChestItemSlot([parentFolder.at(-1),0,51],e[1]+e[2]+2);if(null!=t){t=parseInt(t.attributes.customDescription);let a=api.getStandardChestItemSlot([t,0,51],0).attributes.customDescription;a+=api.getStandardChestItemSlot([t,0,51],1).attributes.customDescription,a=">"+a,dtxt(0,6*e[3]+18,a),e[3]++}return e[1]++,task}return["updateDisplay",["waitTC",["mainMenuClicked"]]]}function updateDisplay(){for(let e=0;e<128;e++)for(let t=0;t<64;t++){let a=display[e][t];if(a[0]!=a[1]){a[0]=a[1];let r=a[1];api.setBlock([e-64,64-t,50],r),display[e][t]=a}}return task[1]}function clearScreen(e){0==task[2]&&(display=[]);for(let t=task[2];t<128;t++){display.push(Array(64));for(let a=0;a<64;a++)display[t][a]=[palette[0],palette[0]];api.setBlockRect([t-64,64,50],[t-64,0,50],api.blockIdToBlockName(palette[0])),task[2]=t}return task[1]}function tick(){if(time++,osOn){jp();try{drawCursor()}catch{}switch(task[0]){case"initmenu":let txt="";for(let i of directory)txt+=i+"/";dtxt(0,0,txt.slice(0,32)),dtxt(0,6,"Back"),dtxt(24,6,"Next"),dtxt(44,6,"Option"),dtxt(88,6,"Dark Mode"),"~/"!=txt&&dtxt(0,12,`Return to ${directory.at(-2)}`),updateDisplay(),chestFiles=Array(36).fill([null,null]),task=["scanFolderItemSlots",2,0];break;case"scanFolderItemSlots":for(;task[1]<36;){let x=api.getStandardChestItemSlot([parentFolder.at(-1),0,51],task[1]);null!=x&&(x=parseInt(x.attributes.customDescription),chestFiles[task[2]]=[api.getStandardChestItemSlot([x,0,51],0).attributes.customDescription+api.getStandardChestItemSlot([x,0,51],1).attributes.customDescription,x],task[2]++),task[1]++}task=["displayFolderSons",curr_page];break;case"displayFolderSons":for(let i=0;i<6;i++)null!=chestFiles[i+task[1]][0]&&dtxt(0,6*i+18,"> "+chestFiles[i+task[1]][0]);task=["updateDisplay",["waitTC",["mainMenuClicked"]]];break;case"updateDisplay":updateDisplay(),task=task[1];break;case"waitTC":.5==s[4]&&(task=task[1]);break;case"clearScreen":clearScreen(),task=task[1];break;case"shut":osOn=!1;break;case"mainMenuClicked":if(inBounds(s[3],6,12)){if(inBounds(s[2],0,16)){curr_page-=6,task=["clearScreen",["initmenu"],0];break}if(inBounds(s[2],24,40)){curr_page+=6,task=["clearScreen",["initmenu"],0];break}if(inBounds(s[2],44,68)){task=["clearScreen",["folderMenu"],0];break}if(inBounds(s[2],88,124)){tmp=palette[0],palette[0]=palette[1],palette[1]=tmp,task=["clearScreen",["initmenu"],0];break}}if(0==(cp=Math.floor(s[3]/6)-2)){parentFolder.length>1&&(parentFolder.pop(),directory.pop(),itemSlotPath.pop()),task=["clearScreen",["initmenu"],0];break}if(null==(cpace=chestFiles[curr_page+cp-1][1])){task=["waitTC",["mainMenuClicked"]];break}if(f=parseInt((f=api.getStandardChestItemSlot([parentFolder.at(-1),0,51],cpace+1)).attributes.customDescription),".fol"==(zf=api.getStandardChestItems([f,0,51]))[1].attributes.customDescription){directory.push(zf[0].attributes.customDescription),parentFolder.push(f),itemSlotPath.push(cpace),curr_page=0,task=["clearScreen",["initmenu"],0];break}task=["clearScreen",["drawFileMenu"],0];break;case"drawFileMenu":cItems=zf.slice(),chestPos=f+0;let name;dtxt(0,0,`File: ${cItems[0].attributes.customDescription+cItems[1].attributes.customDescription}`),dtxt(0,6,"Execute file"),dtxt(0,12,"View file"),dtxt(0,18,"Delete file"),dtxt(0,24,"Back"),updateDisplay(),task=["waitTC",["menuOptionClicked"]];break;case"viewingTextRedir":.5==s[4]&&inBounds(s[3],6,12)&&(inBounds(s[2],0,16)&&(task[1]-=256,task[2]-=256,task[0]="displayFile",task=["clearScreen",task,0]),inBounds(s[2],24,40)&&(task[1]+=256,task[2]+=256,task[0]="displayFile",task=["clearScreen",task,0]),inBounds(s[2],48,64)&&(task=["clearScreen",["drawFileMenu"],0]));break;case"menuOptionClicked":cp2=Math.floor(s[3]/6)+1,program="";for(let i=2;i<36;i++)program+=cItems[i]?.attributes?.customDescription??"";if(inBounds(cp2,2,5))switch(cp2){case 2:if(".js"==(extension=cItems[1].attributes.customDescription)){task=["clearScreen",["initexecute"],0],memory=[];break}if(".txt"==extension){task=["clearScreen",["displayFile",0,256],0];break}if(".ngp"==extension){prog=0,task=["clearScreen",["ngpFormat"],0];break}".rgb"==extension&&(index=0,data="refresh",currCItem=3,xl=parseInt((program=(program=cItems[2].attributes.customDescription).split(" "))[0]),yl=parseInt(program[1]),i=0,j=0,task=["clearScreen",["rgbFormat"],0]);break;case 3:task=["clearScreen",["displayFile",0,256],0];break;case 4:api.setStandardChestItemSlot([parentFolder.at(-1),0,51],cpace+1,"Air",1,void 0),api.setStandardChestItemSlot([chestPos,0,51],0,"Air",1,void 0),task=["clearScreen",["initmenu"],0];break;case 5:curr_page=0,task=["clearScreen",["initmenu"],0]}else task=["waitTC",["menuOptionClicked"]];break;case"execute":s[3]<6&&.5==s[4]&&(task=["clearScreen",["drawFileMenu"],0]),eval(program),dtxt(0,0,"Exit"),updateDisplay();break;case"displayFile":dtxt(0,0,cItems[0].attributes.customDescription+cItems[1].attributes.customDescription),dtxt(0,6,"Back"),dtxt(24,6,"Next"),dtxt(48,6,"Exit"),dtxt(0,12,program.slice(task[1],task[2])),updateDisplay(),task[0]="viewingTextRedir";break;case"initexecute":dtxt(0,0,"Exit"),updateDisplay(),task=["execute"];break;case"folderMenu":dtxt(0,0,"About"),dtxt(0,6,"Exit"),dtxt(0,12,"Upload"),dtxt(0,18,"Delete"),task=["updateDisplay",["waitTC",["folderMenuClicked"]]];break;case"folderMenuClicked":if(inBounds(s[3],0,24)){if(inBounds(s[3],0,6)){task=["clearScreen",["about"],0];break}if(inBounds(s[3],7,12)){task=["clearScreen",["initmenu"],0];break}if(inBounds(s[3],13,18)){task=["clearScreen",["upload"],0];break}inBounds(s[3],19,24)&&(api.setStandardChestItemSlot([parentFolder.at(-2),0,51],itemSlotPath.at(-1),"Air",1,void 0),api.setStandardChestItemSlot([parentFolder.at(-1),0,51],0,"Air",1,void 0),parentFolder.pop(),itemSlotPath.pop(),directory.pop(),task=["clearScreen",["initmenu"],0])}task=["waitTC",["folderMenuClicked"]];break;case"about":dtxt(0,0,"NickOS V2.6.3 (c) 2025 fenl_"),dtxt(0,6,"GPLV3 github.com/tendergalaxy/nickos"),dtxt(0,18,"Credits to the_ccccc, sulfrox, delfineon, and nickname"),dtxt(0,30,"Click to exit"),updateDisplay(),task=["waitTC",["clearScreen",["folderMenu"],0]];break;case"upload":for(dtxt(0,0,"Waiting for user input"),dtxt(0,6,"Click to exit"),updateDisplay(),p=0;p<36&&null!=api.getStandardChestItemSlot([parentFolder.at(-1),0,51],p);)p++;36==p?(dtxt(0,12,"Folder Space Full"),dtxt(0,18,"Delete a file to clear space"),task=["updateDisplay",["waitTC",["clearScreen",["about"],0]]]):task=["findChest"];case"findChest":for(cpos=0;api.getBlock(cpos,0,51).startsWith("Chest")&&null!=api.getStandardChestItemSlot([cpos,0,51],0);)cpos++;task=["waitUpload"];case"waitUpload":if(isFile){api.setStandardChestItemSlot([parentFolder.at(-1),0,51],p,"Net",1,void 0,{customDescription:cpos.toString()}),api.setBlock([cpos,0,51],"Chest"),api.setStandardChestItemSlot([cpos,0,51],0,"Net",1,void 0,{customDescription:fileName}),api.setStandardChestItemSlot([cpos,0,51],1,"Net",1,void 0,{customDescription:extension});for(let i=0;i<34;i++)api.setStandardChestItemSlot([cpos,0,51],i+2,"Net",1,void 0,{customDescription:contents[i]});isFile=!1,task=["clearScreen",["about"],0];break}if(.5==s[4]){task=["clearScreen",["folderMenu"],0];break}case"ngpFormat":dtxt(0,0,"Click to Exit"),"string"==typeof program&&(program=program.split(" ")),yl=parseInt(program[1]),xl=parseInt(program[0]);for(let i=prog;i<yl;i++){for(let j=0;j<xl;j++)display[j][6+i][1]=colors[charset.indexOf(program[2][xl*i+j])];prog=i}task=["updateDisplay",["waitTC",["clearScreen",["drawFileMenu"],0]]];break;case"rgbFormat":if(dtxt(0,0,"Click to Exit"),"refresh"==data){data=cItems[currCItem].attributes.customDescription,index=0;return}for(;i<yl;){for(;j<xl;){if(index==data.length){currCItem++,data="refresh";return}display[j][6+i][1]=cColors[charset.indexOf(data[index])],index++,j++}j=0,i++}task=["updateDisplay",["waitTC",["clearScreen",["drawFileMenu"],0]]]}}}user="doesNotExist",s=[0,0,0,0,0],inBounds=(e,t,a)=>e>=t&&e<=a,osOn=!1,time=0;
