function onPlayerClick(t){let e=api.getHeldItem(t);if(null!=e&&"Spawn Block (Gray)"==e.name&&"NickOS Remote"==e.attributes.customDescription){osOn?(palette[0]=palette[1],task=["clearScreen",["shut"],0]):(OSboot(),user=t);return}osOn&&(s[4]=1)}function getProgram(){program="";for(let t=0;t<cLength;t++){let e=api.getStandardChestItems([chestPos,0,52+t]);for(let i=0;i<36;i++)program+=e[i].attributes.customDescription}return program}function drawBoxOutline(t,e){for(let i=t[1];i<=e[1];i++)display[t[0]][i][1]=palette[1],display[e[0]][i][1]=palette[1];for(let r=t[0];r<=e[0];r++)display[r][t[1]][1]=palette[1],display[r][e[1]][1]=palette[1]}function fillBox(t,e,i){for(let r=t[0];r<=e[0];r++)for(let a=t[1];a<=e[1];a++)display[r][a][1]=i}function onPlayerAttemptAltAction(t){user==t&&osOn&&s[5]}function ctrack(){let t=api.getPlayerFacingInfo(user),e=t.camPos;return((t=t.dir)[0]=t[0]*((50-e[2])/t[2])+e[0],t[1]=t[1]*((50-e[2])/t[2])+e[1],t[0]=Math.round(t[0]+64),t[1]=Math.round(64-t[1]),inBounds(t[0],0,125)&&inBounds(t[1],0,61))?t:[0,0,0]}function jp(){let t=ctrack();s[2]=t[0],s[3]=t[1],t=api.getPosition(user),s[0]=Math.ceil(t[0]),s[1]=Math.ceil(t[2]),s[4]=Math.abs(s[4]-.25)-.25,s[5]=Math.abs(s[4]-.25)-.25}function drawCursor(){let t="100011010";for(let e=0;e<3;e++)for(let i=0;i<3;i++){let r=[s[7]-64+e,64-s[8]-i,50],a=display[s[7]+e][s[8]+i][1];api.setBlock(r,api.blockIdToBlockName(a)),r=[s[2]+e-64,64-s[3]-i,50],api.setBlock(r,api.blockIdToBlockName(palette[t[3*e+i]]))}s[7]=s[2],s[8]=s[3]}function OSboot(){active=[],ram=[],s=[0,0,0,0,0,0,0,0,0],palette=[144,86],display=[],task=["clearScreen",["initmenu"],0],isFile=!1,loadFont(),curr_page=0,parentFolder=[0],directory=["~"],itemSlotPath=[],colors=[144,1724,8,47,483,32,97,59,6,31,28,29,136,85,946,947,948,84,949,950,951,147,66,86].reverse(),charset="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789|[]{}/-_>=+`~?.,;:",cColors=[2,1694,5,650,6,8,139,28,29,31,474,40,41,42,45,465,652,959,958,976,106,1630,1621,1629,946,947,948,949,950,951,482,484,486,471,140,961,962,147,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,97,93,92,90,99,91,94,84,85,89,95,87,88,98,96,86,1722,1056,1271,212,1510,1576,1605,1607,1608,1609],api.log("Welcome to NickOS! - fenl"),osOn=!0}function loadFont(){font={A:"#### ##### ## #",B:"## # ### # ### ",C:"####  #  #  ###",D:"## # ## ## ### ",E:"####  ####  ###",F:"####  ####  #  ",G:"####  # ## ####",H:"# ## ##### ## #",I:"### #  #  # ###",J:"  #  #  ## ####",K:"# ## ### # ## #",L:"#  #  #  #  ###",M:"########## ## #",N:"#### ## ## ## #",O:"#### ## ## ####",P:"#### #####  #  ",Q:"#### ## ## ### ",R:"#### ## ### # #",S:"####   #   ####",T:"### #  #  #  # ",U:"# ## ## ## ####",V:"# ## ## ### #  ",W:"# ## ## #######",X:"# ## # # # ## #",Y:"# ## ## # #  # ",Z:"###  # # #  ###",a:"______ ### # ##",b:"#  #  #### ####",c:"______####  ###",d:"  #  ##### ####",e:"_______#_#_###_",f:"  # # ### #  # ",g:"____#_#_#_####_",h:"#  #  #### ## #",i:"___ # ___ #  # ",j:"  #___  #  ####",k:"#  #  # ### # #",l:"  #  #  #  # # ",m:"______####### #",n:"______#### ## #",o:"______#### ####",p:"___#### #####  ",q:"___#### ####  #",r:"______####  #  ",s:"______ ## # ## ",t:"___ # ### #  # ",u:"______# ## ####",v:"______# ## # # ",w:"______# #######",x:"______# # # # #",y:"______#_#_#_#__",z:"______##  #  ##",0:"#### ## ## ####",1:"##  #  #  # ###",2:"###  #####  ###",3:"###  ####  ####",4:"# ## ####  #  #",5:"####  ###  ####",6:"####  #### ####",7:"###  #  #  #  #",8:"#### ##### ####",9:"#### ####  #  #","-":"______###______","=":"___###___###___",_:"____________###","+":"___ # ### # ___","/":"__#_##_#_##_#__"," ":"               ",".":"_____________#_","!":"_#__#__#_____#_","?":"##___#_#_____#_",">":"______##___###_","<":"_______###___##",":":"____#_____#____",'"':"#_##_#_________","'":"_#__#_#________","&":"_#_#___#_#_###_",",":"__________#_#__","^":"_#_#_##_#______","|":"_#__#__#__#__#_","(":"_#_#__#__#___#_",";":"____#_____#_#__",")":"_#___#__#__#_#_","[":"##_#__#__#__##_","]":"_##__#__#__#_##","%":"#____#_#_#____#","*":"#_#_#_#_#______","{":"_##_#_##__#__##","}":"##__#__##_#_##_","~":"______#_#_#____"}}function dtxt(t,e,i){let r=0;for(let a=0;a<i.length;a++){for(let $=0;$<5;$++)for(let n=0;n<3;n++)"#"==(r=font[i[a]][3*$+n])?display[t+n][e+$][1]=palette[1]:display[t+n][e+$][1]=palette[0];(t+=4)>124&&(t=0,e+=6)}}function displayFolderSons(t){if(t[1]<7&&t[1]+t[2]<36){let e=api.getStandardChestItemSlot([parentFolder.at(-1),0,51],t[1]+t[2]+2);if(null!=e){e=parseInt(e.attributes.customDescription);let i=api.getStandardChestItemSlot([e,0,51],0).attributes.customDescription;i+=api.getStandardChestItemSlot([e,0,51],1).attributes.customDescription,i=">"+i,dtxt(0,6*t[3]+18,i),t[3]++}return t[1]++,task}return["updateDisplay",["waitTC",["mainMenuClicked"]]]}function updateDisplay(){for(let t=0;t<128;t++)for(let e=0;e<64;e++){let i=display[t][e];i[0]!=i[1]&&(i[0]=i[1],api.setBlock([t-64,64-e,50],i[1]),display[t][e]=i)}return task[1]}function clearScreen(t){0==task[2]&&(display=[]);for(let e=task[2];e<128;e++){display.push(Array(64));for(let i=0;i<64;i++)display[e][i]=[palette[0],palette[0]];api.setBlockRect([e-64,64,50],[e-64,0,50],api.blockIdToBlockName(palette[0])),task[2]=e}return task[1]}function tick(ms){if(osOn){api.setClientOption(user,"RightInfoText","NickOS Statistics \n"+ms+"\n"+user+"\n"+parentFolder+"\n"+task),jp();try{drawCursor()}catch{}switch(task[0]){case"initmenu":let txt="";for(let i of directory)txt+=i+"/";dtxt(0,0,txt.slice(0,32)),dtxt(92,0,"<"),dtxt(100,0,">"),dtxt(108,0,"Opt"),"~/"!=txt&&dtxt(0,6,`Return to ${directory.at(-2)}`),updateDisplay(),chestFiles=Array(36).fill([null,null]),task=["scanFolderItemSlots",2,0];break;case"scanFolderItemSlots":for(;task[1]<36;){let x=api.getStandardChestItemSlot([parentFolder.at(-1),0,51],task[1]);null!=x&&(x=parseInt(x.attributes.customDescription),chestFiles[task[2]]=[api.getStandardChestItemSlot([x,0,51],0).attributes.customDescription+api.getStandardChestItemSlot([x,0,51],1).attributes.customDescription,x],task[2]++),task[1]++}task=["displayFolderSons",curr_page];break;case"displayFolderSons":for(let i=0;i<6;i++)null!=chestFiles[i+task[1]][0]&&dtxt(0,6*i+12,"> "+chestFiles[i+task[1]][0]);task=["updateDisplay",["waitTC",["mainMenuClicked"]]];break;case"updateDisplay":updateDisplay(),task=task[1];break;case"waitTC":.5==s[4]&&(task=task[1]);break;case"clearScreen":clearScreen(),task=task[1];break;case"shut":osOn=!1;break;case"mainMenuClicked":if(inBounds(s[3],0,6)){if(inBounds(s[2],92,100)){curr_page-=6,task=["clearScreen",["initmenu"],0];break}if(inBounds(s[2],100,108)){curr_page+=6,task=["clearScreen",["initmenu"],0];break}if(inBounds(s[2],108,128)){task=["folderMenu"];break}if(inBounds(s[2],88,124)){tmp=palette[0],palette[0]=palette[1],palette[1]=tmp,task=["clearScreen",["initmenu"],0];break}}if(0==(cp=Math.floor(s[3]/6)-1)){parentFolder.length>1&&(parentFolder.pop(),directory.pop(),itemSlotPath.pop()),task=["clearScreen",["initmenu"],0];break}if(null==(cpace=chestFiles[curr_page+cp-1][1])){task=["waitTC",["mainMenuClicked"]];break}if(f=parseInt((f=api.getStandardChestItemSlot([parentFolder.at(-1),0,51],cpace+1)).attributes.customDescription),".fol"==(zf=api.getStandardChestItems([f,0,51]))[1].attributes.customDescription){directory.push(zf[0].attributes.customDescription),parentFolder.push(f),itemSlotPath.push(cpace),curr_page=0,task=["clearScreen",["initmenu"],0];break}task=["drawFileMenu"];break;case"drawFileMenu":cLength=parseInt(zf[2].attributes.customDescription),chestPos=f+0;let name=zf[0].attributes.customDescription+zf[1].attributes.customDescription;drawBoxOutline([100,41],[127,63]),fillBox([101,42],[126,62],palette[0]),dtxt(102,43,"Exec X"),dtxt(102,49,"Raw"),dtxt(102,55,"Del"),updateDisplay(),task=["waitTC",["menuOptionClicked"]];break;case"viewingTextRedir":.5==s[4]&&inBounds(s[3],6,12)&&(inBounds(s[2],0,16)&&(task[1]-=256,task[2]-=256,task[0]="displayFile",task=["clearScreen",task,0]),inBounds(s[2],24,40)&&(task[1]+=256,task[2]+=256,task[0]="displayFile",task=["clearScreen",task,0]),inBounds(s[2],48,64)&&(task=["clearScreen",["initmenu"],0]));break;case"menuOptionClicked":if(inBounds(s[3],43,61)){if(inBounds(s[3],43,48)){if(inBounds(s[2],120,128)){curr_page=0,task=["clearScreen",["initmenu"],0];break}if(".js"==(extension=zf[1].attributes.customDescription)){getProgram(),task=["clearScreen",["initexecute"],0],memory=[];break}if(".txt"==extension){getProgram(),task=["clearScreen",["displayFile",0,256],0];break}if(".ngp"==extension){getProgram(),prog=0,task=["clearScreen",["ngpFormat"],0];break}if(".rgb"==extension){getProgram(),prog=0,task=["clearScreen",["rgbFormat"],0];break}".nvf"==extension&&(xl=parseInt((program=(program=api.getStandardChestItemSlot([chestPos,0,52],0).attributes.customDescription).split(" "))[0]),yl=parseInt(program[1]),frameCount=parseInt(program[2]),data_idx=0,currCPos=0,currCItem=0,idx=0,j=0,pos=0,data=program[3],task=["clearScreen",["playVideoFrame"],0]);break}if(inBounds(s[3],49,55)){getProgram(),task=["clearScreen",["displayFile",0,256],0];break}inBounds(s[3],55,61)&&(api.setStandardChestItemSlot([parentFolder.at(-1),0,51],cpace+1,"Air",1,void 0),api.setStandardChestItemSlot([chestPos,0,51],0,"Air",1,void 0),api.setBlock([chestPos,0,51],"Air"),task=["clearScreen",["initmenu"],0])}else task=["waitTC",["menuOptionClicked"]];break;case"execute":s[3]<6&&.5==s[4]&&(task=["clearScreen",["initmenu"],0]),eval(program),dtxt(0,0,"Exit"),updateDisplay();break;case"displayFile":dtxt(0,0,zf[0].attributes.customDescription+zf[1].attributes.customDescription),dtxt(0,6,"Back"),dtxt(24,6,"Next"),dtxt(48,6,"Exit"),dtxt(0,12,program.slice(task[1],task[2])),updateDisplay(),task[0]="viewingTextRedir";break;case"initexecute":dtxt(0,0,"Exit"),updateDisplay(),task=["execute"];break;case"folderMenu":drawBoxOutline([93,6],[127,28]),fillBox([94,7],[126,27],palette[0]),dtxt(95,8,"About X"),dtxt(95,14,"Upload"),dtxt(95,20,"Delete"),task=["updateDisplay",["waitTC",["folderMenuClicked"]]];break;case"folderMenuClicked":if(inBounds(s[3],8,26)&&inBounds(s[2],97,127)){if(inBounds(s[3],8,13)){inBounds(s[2],97,119)&&(task=["about"]),inBounds(s[2],120,124)&&(task=["clearScreen",["initmenu"],0]);break}if(inBounds(s[3],14,19)){fillBox([4,4],[94,23],palette[0]),drawBoxOutline([3,3],[95,24]),task=["upload"];break}inBounds(s[3],20,26)&&(api.setStandardChestItemSlot([parentFolder.at(-2),0,51],itemSlotPath.at(-1),"Air",1,void 0),api.setStandardChestItemSlot([parentFolder.at(-1),0,51],0,"Air",1,void 0),api.setBlock([parentFolder.at(-1),0,51],"Air"),parentFolder.pop(),itemSlotPath.pop(),directory.pop(),task=["clearScreen",["initmenu"],0])}task=["waitTC",["folderMenuClicked"]];break;case"about":fillBox([6,6],[112,30],palette[0]),drawBoxOutline([5,5],[113,31]),dtxt(7,7,"NickOS V2.9.0 by fenl_"),dtxt(7,13,"Credits to the_ccccc, sulf"),dtxt(7,19,"rox, delfineon, & nickname"),dtxt(7,25,"Click to exit"),updateDisplay(),task=["waitTC",["clearScreen",["initmenu"],0]];break;case"upload":for(dtxt(5,5,"Waiting for user input"),dtxt(5,11,"Click to exit"),updateDisplay(),p=0;p<36&&null!=api.getStandardChestItemSlot([parentFolder.at(-1),0,51],p);)p++;36==p?(dtxt(5,17,"Folder Space Full"),task=["updateDisplay",["waitTC",["clearScreen",["initmenu"],0]]]):task=["findChest"];case"findChest":for(cpos=0,y=0;api.getBlock(cpos,0,51).startsWith("Chest")&&null!=api.getStandardChestItemSlot([cpos,0,51],0);)cpos++;task=["waitUpload"];case"waitUpload":if(isFile){for(api.setStandardChestItemSlot([parentFolder.at(-1),0,51],p,"Net",1,void 0,{customDescription:cpos.toString()}),api.setBlock([cpos,0,51],"Chest"),api.setStandardChestItemSlot([cpos,0,51],0,"Net",1,void 0,{customDescription:fileName}),api.setStandardChestItemSlot([cpos,0,51],1,"Net",1,void 0,{customDescription:extension}),api.setStandardChestItemSlot([cpos,0,51],2,"Net",1,void 0,{customDescription:(contents.length/36).toString()});y<contents.length/36;y++){api.setBlock([cpos,0,52+y],"Chest");for(let i=0;i<36;i++)api.setStandardChestItemSlot([cpos,0,52+y],i,"Net",1,void 0,{customDescription:contents[36*y+i]})}isFile=!1,task=["clearScreen",["initmenu"],0];break}if(.5==s[4]){task=["clearScreen",["initmenu"],0];break}case"ngpFormat":dtxt(0,0,"Click to Exit"),"string"==typeof program&&(program=program.split(" ")),yl=parseInt(program[1]),xl=parseInt(program[0]);for(let i=prog;i<yl;i++){for(let j=0;j<xl;j++)display[j][6+i][1]=colors[charset.indexOf(program[2][xl*i+j])];prog=i}task=["updateDisplay",["waitTC",["clearScreen",["initmenu"],0]]];break;case"rgbFormat":dtxt(0,0,"Click to Exit"),"string"==typeof program&&(program=program.split(" ")),yl=parseInt(program[1]),xl=parseInt(program[0]);for(let i=prog;i<yl;i++){for(let j=0;j<xl;j++)display[j][6+i][1]=cColors[charset.indexOf(program[2][xl*i+j])];prog=i}task=["updateDisplay",["waitTC",["clearScreen",["initmenu"],0]]];break;case"playVideoFrame":if(idx==frameCount){task=["waitTC",["clearScreen",["initmenu"],0]];break}if("REFRESH"==data){data_idx=0,36==++currCItem&&(currCItem=0,currCPos++),data=api.getStandardChestItemSlot([chestPos,0,52+currCPos],currCItem).attributes.customDescription;return}for(;"EOF"!=pos&&pos<xl*yl;){if(32==(item=data[data_idx].codePointAt(0))){pos="EOF";continue}for(length=Math.floor(item/100),item%=100;j<length;)79!=item&&(display[pos%xl][Math.floor(pos/xl)][1]=cColors[item]),pos++,j++;if(j=0,api.log(pos,item,length),++data_idx>=data.length){data="REFRESH";return}}idx++,pos=0,++data_idx>=data.length&&(data="REFRESH"),task=["updateDisplay",["playVideoFrame"]]}}}user="doesNotExist",s=[0,0,0,0,0],inBounds=(t,e,i)=>t>=e&&t<=i,osOn=!1;
